{% extends "base.html" %}

{% block content %}

<!-- index.html content starts here -->
<div class="container-fluid m-auto">
    <div id="map" style="width:auto; height: 80vh;"></div>
    <script>
        // Initialize the map with a specific area and zoom level
        let map = L.map('map').setView([-20.195911176540697, -43.69507934447964], 9);
    
        // Base map layer (tile layer) from OpenStreetMap
        let OpenTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        maxZoom: 17,
        attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
        }).addTo(map);
    

        // Custom icon for cave markers
        let caveIcon = L.icon({
            iconUrl: "/static/images/logo-pt.png",
            iconSize: [20, 20],
            iconAnchor: [15, 15],
            popupAnchor: [-10, -10]
        });
    
        // Loop through databank and add markers to the map
        {% for cave in caves %}
        let marker{{ cave.id }} = L.marker([{{ cave.latitude }}, {{ cave.longitude }}], {icon: caveIcon})
            .bindPopup('<a href="{% url "cave_page" cave_name=cave.cave_name %}" target="_blank"><b>{{ cave.cave_name }}</b></a><br>Length: {{ cave.length }}<br>Depth: {{ cave.depth }}<br>Area: {{ cave.area }}<br>Volume: {{ cave.volume }}<br>Author: <a href="{% url "profile_page" username=cave.user.username %}" target="_blank">{{ cave.user.username }}</a>')
            .addTo(map);
        {% endfor %}
    </script>
</div>

<!-- index.html content ends here -->
{% endblock %}